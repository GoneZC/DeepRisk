{"ast":null,"code":"import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nvar _hoisted_1 = {\n  \"class\": \"data-collection-monitor\"\n};\nvar _hoisted_2 = {\n  \"class\": \"status-cards\"\n};\nvar _hoisted_3 = {\n  \"class\": \"status-card\"\n};\nvar _hoisted_4 = {\n  \"class\": \"card-value\"\n};\nvar _hoisted_5 = {\n  \"class\": \"status-card\"\n};\nvar _hoisted_6 = {\n  \"class\": \"card-value\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_el_button = _resolveComponent(\"el-button\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[3] || (_cache[3] = _createElementVNode(\"h2\", null, \"数据采集实时监控\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_cache[0] || (_cache[0] = _createElementVNode(\"div\", {\n    \"class\": \"card-title\"\n  }, \"已处理数据\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_4, _toDisplayString($data.processedCount), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_5, [_cache[1] || (_cache[1] = _createElementVNode(\"div\", {\n    \"class\": \"card-title\"\n  }, \"触发规则数据\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_6, _toDisplayString($data.ruleTriggeredCount), 1 /* TEXT */)])]), _createVNode(_component_el_button, {\n    type: \"primary\",\n    onClick: $options.triggerCollection,\n    loading: $data.loading\n  }, {\n    \"default\": _withCtx(function () {\n      return _cache[2] || (_cache[2] = [_createTextVNode(\" 模拟数据采集 \")]);\n    }),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"onClick\", \"loading\"])]);\n}","map":{"version":3,"names":["_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","$data","processedCount","_hoisted_5","_hoisted_6","ruleTriggeredCount","_createVNode","_component_el_button","type","onClick","$options","triggerCollection","loading","_withCtx","_cache","_createTextVNode","_"],"sources":["D:\\Code\\Project\\Medical Insurance Anti-Fraud System\\frontend\\src\\views\\DataMonitor.vue"],"sourcesContent":["<template>\r\n  <div class=\"data-collection-monitor\">\r\n    <h2>数据采集实时监控</h2>\r\n    <div class=\"status-cards\">\r\n      <div class=\"status-card\">\r\n        <div class=\"card-title\">已处理数据</div>\r\n        <div class=\"card-value\">{{ processedCount }}</div>\r\n      </div>\r\n      <div class=\"status-card\">\r\n        <div class=\"card-title\">触发规则数据</div>\r\n        <div class=\"card-value\">{{ ruleTriggeredCount }}</div>\r\n      </div>\r\n    </div>\r\n    \r\n    <el-button type=\"primary\" @click=\"triggerCollection\" :loading=\"loading\">\r\n      模拟数据采集\r\n    </el-button>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport SockJS from 'sockjs-client';\r\nimport Stomp from 'webstomp-client';\r\nimport axios from 'axios';\r\n\r\naxios.defaults.baseURL = 'http://localhost:8083'; // 使用后端实际端口\r\n\r\nexport default {\r\n  name: 'DataMonitor',\r\n  data() {\r\n    return {\r\n      processedCount: 0,\r\n      ruleTriggeredCount: 0,\r\n      stompClient: null,\r\n      connected: false,\r\n      loading: false\r\n    }\r\n  },\r\n  mounted() {\r\n    this.connectWebSocket();\r\n    // 初始获取一次状态\r\n    this.getStatus();\r\n  },\r\n  methods: {\r\n    connectWebSocket() {\r\n      try {\r\n        // 使用完整的URL，确保端口匹配\r\n        const socket = new SockJS('http://localhost:8081/ws-data-collection');\r\n        this.stompClient = Stomp.over(socket);\r\n        \r\n        this.stompClient.connect({}, frame => {\r\n          console.log('Connected to WebSocket: ' + frame);\r\n          \r\n          // 订阅状态更新\r\n          this.stompClient.subscribe('/topic/collection-status', response => {\r\n            const statusUpdate = JSON.parse(response.body);\r\n            console.log('收到状态更新:', statusUpdate);\r\n            \r\n            // 更新计数器\r\n            this.processedCount = statusUpdate.processedCount;\r\n            this.ruleTriggeredCount = statusUpdate.ruleTriggeredCount;\r\n          });\r\n          \r\n        }, error => {\r\n          console.error('WebSocket连接错误:', error);\r\n        });\r\n        \r\n      } catch (e) {\r\n        console.error('WebSocket初始化错误:', e);\r\n      }\r\n    },\r\n    triggerCollection() {\r\n      this.loading = true;\r\n      axios.post('/api/data-collection/collect')\r\n        .then(() => {\r\n          console.log('数据采集触发成功');\r\n        })\r\n        .catch(error => {\r\n          console.error('数据采集触发失败:', error);\r\n        })\r\n        .finally(() => {\r\n          this.loading = false;\r\n        });\r\n    },\r\n    getStatus() {\r\n      axios.get('/api/data-collection/status')\r\n        .then(response => {\r\n          this.processedCount = response.data.processedCount;\r\n          this.ruleTriggeredCount = response.data.ruleTriggeredCount;\r\n        })\r\n        .catch(error => {\r\n          console.error('获取状态失败:', error);\r\n        });\r\n    }\r\n  },\r\n  beforeUnmount() {\r\n    if (this.stompClient && this.stompClient.connected) {\r\n      this.stompClient.disconnect();\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.data-collection-monitor {\r\n  padding: 20px;\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n}\r\n.status-cards {\r\n  display: flex;\r\n  gap: 20px;\r\n  margin-bottom: 20px;\r\n}\r\n.status-card {\r\n  flex: 1;\r\n  padding: 20px;\r\n  border-radius: 8px;\r\n  background-color: #f5f7fa;\r\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\r\n  text-align: center;\r\n}\r\n.card-title {\r\n  font-size: 16px;\r\n  color: #606266;\r\n  margin-bottom: 10px;\r\n}\r\n.card-value {\r\n  font-size: 28px;\r\n  font-weight: bold;\r\n  color: #409EFF;\r\n}\r\n</style> "],"mappings":";;EACO,SAAM;AAAyB;;EAE7B,SAAM;AAAc;;EAClB,SAAM;AAAa;;EAEjB,SAAM;AAAY;;EAEpB,SAAM;AAAa;;EAEjB,SAAM;AAAY;;;uBAT7BA,mBAAA,CAgBM,OAhBNC,UAgBM,G,0BAfJC,mBAAA,CAAiB,YAAb,UAAQ,sBACZA,mBAAA,CASM,OATNC,UASM,GARJD,mBAAA,CAGM,OAHNE,UAGM,G,0BAFJF,mBAAA,CAAmC;IAA9B,SAAM;EAAY,GAAC,OAAK,sBAC7BA,mBAAA,CAAkD,OAAlDG,UAAkD,EAAAC,gBAAA,CAAvBC,KAAA,CAAAC,cAAc,iB,GAE3CN,mBAAA,CAGM,OAHNO,UAGM,G,0BAFJP,mBAAA,CAAoC;IAA/B,SAAM;EAAY,GAAC,QAAM,sBAC9BA,mBAAA,CAAsD,OAAtDQ,UAAsD,EAAAJ,gBAAA,CAA3BC,KAAA,CAAAI,kBAAkB,iB,KAIjDC,YAAA,CAEYC,oBAAA;IAFDC,IAAI,EAAC,SAAS;IAAEC,OAAK,EAAEC,QAAA,CAAAC,iBAAiB;IAAGC,OAAO,EAAEX,KAAA,CAAAW;;IAdnE,WAAAC,QAAA,CAc4E;MAAA,OAExEC,MAAA,QAAAA,MAAA,OAhBJC,gBAAA,CAc4E,UAExE,E;;IAhBJC,CAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}